<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Direct Sensitivity Analysis Functionality · SciMLSensitivity.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/SciMLSensitivity/stable/tutorials/direct_sensitivity/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="SciMLSensitivity.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SciMLSensitivity.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">SciMLSensitivity: Automatic Differentiation and Adjoints for (Differential) Equation Solvers</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started with SciMLSensitivity: Differentiating ODE Solutions</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../parameter_estimation_ode/">Parameter Estimation of Ordinary Differential Equations</a></li><li class="is-active"><a class="tocitem" href>Direct Sensitivity Analysis Functionality</a><ul class="internal"><li><a class="tocitem" href="#Example-using-an-ODEForwardSensitivityProblem"><span>Example using an ODEForwardSensitivityProblem</span></a></li><li><a class="tocitem" href="#Example-using-adjoint_sensitivities-for-discrete-adjoints"><span>Example using <code>adjoint_sensitivities</code> for discrete adjoints</span></a></li></ul></li><li><a class="tocitem" href="../adjoint_continuous_functional/">Adjoint Sensitivity Analysis of Continuous Functionals</a></li><li><a class="tocitem" href="../data_parallel/">Data-Parallel Multithreaded, Distributed, and Multi-GPU Batching</a></li><li><a class="tocitem" href="../chaotic_ode/">Sensitivity analysis for chaotic systems (shadowing methods)</a></li><li><input class="collapse-toggle" id="menuitem-3-6" type="checkbox"/><label class="tocitem" for="menuitem-3-6"><span class="docs-label">Training Techniques and Tips</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../training_tips/local_minima/">Strategies to Avoid Local Minima</a></li><li><a class="tocitem" href="../training_tips/divergence/">Handling Divergent and Unstable Trajectories</a></li><li><a class="tocitem" href="../training_tips/multiple_nn/">Simultaneous Fitting of Multiple Neural Networks</a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Ordinary Differential Equations (ODEs)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/ode/exogenous_input/">Handling Exogenous Input Signals</a></li><li><a class="tocitem" href="../../examples/ode/prediction_error_method/">Prediction error method (PEM)</a></li><li><a class="tocitem" href="../../examples/ode/second_order_adjoints/">Newton and Hessian-Free Newton-Krylov with Second Order Adjoint Sensitivity Analysis</a></li><li><a class="tocitem" href="../../examples/ode/second_order_neural/">Neural Second Order Ordinary Differential Equation</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Neural Ordinary Differential Equations (Neural ODE)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/neural_ode/neural_ode_flux/">Neural Ordinary Differential Equations with Flux</a></li><li><a class="tocitem" href="../../examples/neural_ode/simplechains/">Neural Ordinary Differential Equations with SimpleChains</a></li><li><a class="tocitem" href="../../examples/neural_ode/neural_gde/">Neural Graph Differential Equations</a></li><li><a class="tocitem" href="../../examples/neural_ode/minibatch/">Training a Neural Ordinary Differential Equation with Mini-Batching</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Stochastic Differential Equations (SDEs)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/sde/optimization_sde/">Optimization of Stochastic Differential Equations</a></li><li><a class="tocitem" href="../../examples/sde/SDE_control/">Controlling Stochastic Differential Equations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Delay Differential Equations (DDEs)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/dde/delay_diffeq/">Delay Differential Equations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Differential-Algebraic Equations (DAEs)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/dae/physical_constraints/">Enforcing Physical Constraints via Universal Differential-Algebraic Equations</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Partial Differential Equations (PDEs)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/pde/pde_constrained/">Partial Differential Equation (PDE) Constrained Optimization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-7" type="checkbox"/><label class="tocitem" for="menuitem-4-7"><span class="docs-label">Hybrid and Jump Equations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/hybrid_jump/hybrid_diffeq/">Training Neural Networks in Hybrid Differential Equations</a></li><li><a class="tocitem" href="../../examples/hybrid_jump/bouncing_ball/">Bouncing Ball Hybrid ODE Optimization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-8" type="checkbox"/><label class="tocitem" for="menuitem-4-8"><span class="docs-label">Bayesian Estimation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/bayesian/turing_bayesian/">Bayesian Estimation of Differential Equations with Probabilistic Programming</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-9" type="checkbox"/><label class="tocitem" for="menuitem-4-9"><span class="docs-label">Optimal and Model Predictive Control</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/optimal_control/optimal_control/">Solving Optimal Control Problems with Universal Differential Equations</a></li><li><a class="tocitem" href="../../examples/optimal_control/feedback_control/">Universal Differential Equations for Neural Feedback Control</a></li></ul></li></ul></li><li><span class="tocitem">Manual and APIs</span><ul><li><a class="tocitem" href="../../manual/differential_equation_sensitivities/">Sensitivity Algorithms for Differential Equations with Automatic Differentiation (AD)</a></li><li><a class="tocitem" href="../../manual/nonlinear_solve_sensitivities/">Sensitivity Algorithms for Nonlinear Problems with Automatic Differentiation (AD)</a></li><li><a class="tocitem" href="../../manual/direct_forward_sensitivity/">Direct Forward Sensitivity Analysis of ODEs</a></li><li><a class="tocitem" href="../../manual/direct_adjoint_sensitivities/">Direct Adjoint Sensitivities of Differential Equations</a></li></ul></li><li><a class="tocitem" href="../../Benchmark/">Benchmarks</a></li><li><a class="tocitem" href="../../sensitivity_math/">Sensitivity Math Details</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Direct Sensitivity Analysis Functionality</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Direct Sensitivity Analysis Functionality</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/DiffEqSensitivity.jl/blob/master/docs/src/tutorials/direct_sensitivity.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="direct_sensitivity"><a class="docs-heading-anchor" href="#direct_sensitivity">Direct Sensitivity Analysis Functionality</a><a id="direct_sensitivity-1"></a><a class="docs-heading-anchor-permalink" href="#direct_sensitivity" title="Permalink"></a></h1><p>While sensitivity analysis tooling can be used implicitly via integration with automatic differentiation libraries, one can often times obtain more speed and flexibility with the direct sensitivity analysis interfaces. This tutorial demonstrates some of those functions.</p><h2 id="Example-using-an-ODEForwardSensitivityProblem"><a class="docs-heading-anchor" href="#Example-using-an-ODEForwardSensitivityProblem">Example using an ODEForwardSensitivityProblem</a><a id="Example-using-an-ODEForwardSensitivityProblem-1"></a><a class="docs-heading-anchor-permalink" href="#Example-using-an-ODEForwardSensitivityProblem" title="Permalink"></a></h2><p>Forward sensitivity analysis is performed by defining and solving an augmented ODE. To define this augmented ODE, use the <code>ODEForwardSensitivityProblem</code> type instead of an ODE type. For example, we generate an ODE with the sensitivity equations attached to the Lotka-Volterra equations by:</p><pre><code class="language-julia hljs">using OrdinaryDiffEq, SciMLSensitivity

function f(du, u, p, t)
    du[1] = dx = p[1] * u[1] - p[2] * u[1] * u[2]
    du[2] = dy = -p[3] * u[2] + u[1] * u[2]
end

p = [1.5, 1.0, 3.0]
prob = ODEForwardSensitivityProblem(f, [1.0; 1.0], (0.0, 10.0), p)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEProblem with uType Vector{Float64} and tType Float64. In-place: true
timespan: (0.0, 10.0)
u0: 8-element Vector{Float64}:
 1.0
 1.0
 0.0
 0.0
 0.0
 0.0
 0.0
 0.0</code></pre><p>This generates a problem which the ODE solvers can solve:</p><pre><code class="language-julia hljs">sol = solve(prob, DP8())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: specialized 7th order interpolation
t: 29-element Vector{Float64}:
  0.0
  0.0008156803234081559
  0.005709762263857092
  0.0350742539065507
  0.21126120376271237
  0.7310736576107115
  1.540222712617339
  1.8813610466661779
  2.152579392464959
  2.4063311841696478
  ⋮
  7.063355055637446
  7.725935939669195
  8.248979441432317
  8.558003582514011
  8.826370842927059
  9.171011754187145
  9.493946497917326
  9.834929283472757
 10.0
u: 29-element Vector{Vector{Float64}}:
 [1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
 [1.000408588538797, 0.9983701355642965, 0.000816013510644824, 3.322154010506493e-7, -0.0008153483114736799, -3.320348233838799e-7, 3.3244140163739216e-7, -0.0008143507848015046]
 [1.0028915156848317, 0.9886535575433295, 0.005726241237749595, 1.614666165725367e-5, -0.005693685298331232, -1.608538141187711e-5, 1.622392391840203e-5, -0.005644946211107334]
 [1.0189121274128703, 0.9325571368196612, 0.03573056561405724, 0.0005806610224735032, -0.03450963303532001, -0.0005673264615114403, 0.0005982168608307318, -0.03270217921302392]
 [1.1547444753248808, 0.6650474487943194, 0.24252997273953156, 0.01620058797923608, -0.19849894573997498, -0.014142604007354063, 0.019606496433572658, -0.13955624899729321]
 [1.9959026411822725, 0.30725094819300275, 1.391133265855036, 0.12370946057242034, -0.759957001986062, -0.07996649485520488, 0.22938885567774328, -0.20775306589835096]
 [5.301945679460528, 0.4275038176301523, 6.007173244666842, 1.3784417780305684, -2.2838704251834274, -0.6234622488931597, 1.6987114297214057, -0.3708646913283793]
 [6.870272331090136, 1.2712401591810771, 2.4824496263591573, 6.439151700037795, -1.3710505647874733, -2.7849768648683657, 3.27150175115394, -0.46731359361629615]
 [5.6794465138430255, 3.339970308115974, -12.310270279196539, 12.730860582111314, 2.905632054599127, -6.735838408409473, 2.673562949656807, 0.8629101364446883]
 [2.8838282002507127, 4.574038579879981, -11.501924757547972, 1.5722474815418714, 3.1495602823896394, -5.129125042632571, 0.2620888410181721, 1.5914280086424009]
 ⋮
 [1.418855937319193, 0.4574711772199034, 4.034573057599186, -1.6292340104788632, -0.023285315385672353, -0.22674039853297226, 0.9917652543963265, -0.638337264202253]
 [3.105286408605591, 0.25723901264027343, 12.030706505671958, 0.36572886497419194, -0.3594670814358708, -0.15629621495384521, 2.9860724103158987, -0.21350725434856999]
 [5.721950106631202, 0.514779144978057, 19.322713832885785, 5.150407774561501, -0.8979267203135411, -0.47678878799789404, 5.486826628062348, 0.4525830529452751]
 [6.904564479111672, 1.4959711323293128, 0.811146043851416, 21.257023017125416, -0.8855299002913148, -1.8375564764102368, 3.431317057907703, 3.2107869988584503]
 [5.2514086334165695, 3.6770818940450147, -40.30711600763182, 31.383646964911673, 0.41550560341403064, -4.822192363404215, -4.808988602487428, 6.282699534622159]
 [1.9684993733166813, 4.224446642146777, -19.72010623548467, -13.790594696972661, 0.6970930173849295, -4.432962960251742, -3.4673013009932507, -1.7679946525107322]
 [1.0719720028424042, 2.526693902267381, -4.294296713681606, -16.729797806817643, 0.34070229001622293, -2.248550140903405, -0.8127688495258221, -3.427976964414843]
 [0.9574127494597944, 1.2680817248527796, 0.6626271434786215, -9.021542819507195, 0.2124981690849138, -1.0143392771168307, 0.214003821176142, -2.255216297402648]
 [1.0265055472860183, 0.90952512549586, 2.1626974566893358, -6.25648991633221, 0.18838932142447534, -0.6976152811241171, 0.5638188536930512, -1.7090441864606376]</code></pre><p>Note that the solution is the standard ODE system and the sensitivity system combined. We can use the following helper functions to extract the sensitivity information:</p><pre><code class="language-julia hljs">x, dp = extract_local_sensitivities(sol)
x, dp = extract_local_sensitivities(sol, i)
x, dp = extract_local_sensitivities(sol, t)</code></pre><p>In each case, <code>x</code> is the ODE values and <code>dp</code> is the matrix of sensitivities The first gives the full timeseries of values and <code>dp[i]</code> contains the time series of the sensitivities of all components of the ODE with respect to <code>i</code>th parameter. The second returns the <code>i</code>th time step, while the third interpolates to calculate the sensitivities at time <code>t</code>. For example, if we do:</p><pre><code class="language-julia hljs">x, dp = extract_local_sensitivities(sol)
da = dp[1]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2×29 Matrix{Float64}:
 0.0  0.000816014  0.00572624  0.0357306    …   -4.2943   0.662627   2.1627
 0.0  3.32215e-7   1.61467e-5  0.000580661     -16.7298  -9.02154   -6.25649</code></pre><p>then <code>da</code> is the timeseries for <span>$\frac{\partial u(t)}{\partial p}$</span>. We can plot this</p><pre><code class="language-julia hljs">using Plots
plot(sol.t, da&#39;, lw = 3)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip830">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip830)" d="M0 1600 L2400 1600 L2400 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip831">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip830)" d="M178.867 1486.45 L2352.76 1486.45 L2352.76 47.2441 L178.867 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip832">
    <rect x="178" y="47" width="2175" height="1440"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="240.392,1486.45 240.392,47.2441 "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="753.102,1486.45 753.102,47.2441 "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1265.81,1486.45 1265.81,47.2441 "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1778.52,1486.45 1778.52,47.2441 "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2291.23,1486.45 2291.23,47.2441 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="178.867,1486.45 2352.76,1486.45 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="240.392,1486.45 240.392,1467.55 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="753.102,1486.45 753.102,1467.55 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1265.81,1486.45 1265.81,1467.55 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1778.52,1486.45 1778.52,1467.55 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2291.23,1486.45 2291.23,1467.55 "/>
<path clip-path="url(#clip830)" d="M217.776 1517.37 Q214.165 1517.37 212.336 1520.93 Q210.531 1524.47 210.531 1531.6 Q210.531 1538.71 212.336 1542.27 Q214.165 1545.82 217.776 1545.82 Q221.41 1545.82 223.216 1542.27 Q225.045 1538.71 225.045 1531.6 Q225.045 1524.47 223.216 1520.93 Q221.41 1517.37 217.776 1517.37 M217.776 1513.66 Q223.586 1513.66 226.642 1518.27 Q229.721 1522.85 229.721 1531.6 Q229.721 1540.33 226.642 1544.94 Q223.586 1549.52 217.776 1549.52 Q211.966 1549.52 208.887 1544.94 Q205.832 1540.33 205.832 1531.6 Q205.832 1522.85 208.887 1518.27 Q211.966 1513.66 217.776 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M237.938 1542.97 L242.822 1542.97 L242.822 1548.85 L237.938 1548.85 L237.938 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M263.007 1517.37 Q259.396 1517.37 257.568 1520.93 Q255.762 1524.47 255.762 1531.6 Q255.762 1538.71 257.568 1542.27 Q259.396 1545.82 263.007 1545.82 Q266.642 1545.82 268.447 1542.27 Q270.276 1538.71 270.276 1531.6 Q270.276 1524.47 268.447 1520.93 Q266.642 1517.37 263.007 1517.37 M263.007 1513.66 Q268.818 1513.66 271.873 1518.27 Q274.952 1522.85 274.952 1531.6 Q274.952 1540.33 271.873 1544.94 Q268.818 1549.52 263.007 1549.52 Q257.197 1549.52 254.119 1544.94 Q251.063 1540.33 251.063 1531.6 Q251.063 1522.85 254.119 1518.27 Q257.197 1513.66 263.007 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M724.838 1544.91 L741.157 1544.91 L741.157 1548.85 L719.213 1548.85 L719.213 1544.91 Q721.875 1542.16 726.458 1537.53 Q731.065 1532.88 732.245 1531.53 Q734.491 1529.01 735.37 1527.27 Q736.273 1525.51 736.273 1523.82 Q736.273 1521.07 734.328 1519.33 Q732.407 1517.6 729.305 1517.6 Q727.106 1517.6 724.653 1518.36 Q722.222 1519.13 719.444 1520.68 L719.444 1515.95 Q722.268 1514.82 724.722 1514.24 Q727.176 1513.66 729.213 1513.66 Q734.583 1513.66 737.778 1516.35 Q740.972 1519.03 740.972 1523.52 Q740.972 1525.65 740.162 1527.57 Q739.375 1529.47 737.268 1532.07 Q736.69 1532.74 733.588 1535.95 Q730.486 1539.15 724.838 1544.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M750.972 1542.97 L755.856 1542.97 L755.856 1548.85 L750.972 1548.85 L750.972 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M766.088 1514.29 L784.444 1514.29 L784.444 1518.22 L770.37 1518.22 L770.37 1526.7 Q771.388 1526.35 772.407 1526.19 Q773.426 1526 774.444 1526 Q780.231 1526 783.611 1529.17 Q786.99 1532.34 786.99 1537.76 Q786.99 1543.34 783.518 1546.44 Q780.046 1549.52 773.726 1549.52 Q771.551 1549.52 769.282 1549.15 Q767.037 1548.78 764.629 1548.04 L764.629 1543.34 Q766.713 1544.47 768.935 1545.03 Q771.157 1545.58 773.634 1545.58 Q777.638 1545.58 779.976 1543.48 Q782.314 1541.37 782.314 1537.76 Q782.314 1534.15 779.976 1532.04 Q777.638 1529.94 773.634 1529.94 Q771.759 1529.94 769.884 1530.35 Q768.032 1530.77 766.088 1531.65 L766.088 1514.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1232.98 1514.29 L1251.33 1514.29 L1251.33 1518.22 L1237.26 1518.22 L1237.26 1526.7 Q1238.28 1526.35 1239.3 1526.19 Q1240.31 1526 1241.33 1526 Q1247.12 1526 1250.5 1529.17 Q1253.88 1532.34 1253.88 1537.76 Q1253.88 1543.34 1250.41 1546.44 Q1246.93 1549.52 1240.61 1549.52 Q1238.44 1549.52 1236.17 1549.15 Q1233.92 1548.78 1231.52 1548.04 L1231.52 1543.34 Q1233.6 1544.47 1235.82 1545.03 Q1238.05 1545.58 1240.52 1545.58 Q1244.53 1545.58 1246.86 1543.48 Q1249.2 1541.37 1249.2 1537.76 Q1249.2 1534.15 1246.86 1532.04 Q1244.53 1529.94 1240.52 1529.94 Q1238.65 1529.94 1236.77 1530.35 Q1234.92 1530.77 1232.98 1531.65 L1232.98 1514.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1263.09 1542.97 L1267.98 1542.97 L1267.98 1548.85 L1263.09 1548.85 L1263.09 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1288.16 1517.37 Q1284.55 1517.37 1282.72 1520.93 Q1280.92 1524.47 1280.92 1531.6 Q1280.92 1538.71 1282.72 1542.27 Q1284.55 1545.82 1288.16 1545.82 Q1291.79 1545.82 1293.6 1542.27 Q1295.43 1538.71 1295.43 1531.6 Q1295.43 1524.47 1293.6 1520.93 Q1291.79 1517.37 1288.16 1517.37 M1288.16 1513.66 Q1293.97 1513.66 1297.03 1518.27 Q1300.11 1522.85 1300.11 1531.6 Q1300.11 1540.33 1297.03 1544.94 Q1293.97 1549.52 1288.16 1549.52 Q1282.35 1549.52 1279.27 1544.94 Q1276.22 1540.33 1276.22 1531.6 Q1276.22 1522.85 1279.27 1518.27 Q1282.35 1513.66 1288.16 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1744.84 1514.29 L1767.06 1514.29 L1767.06 1516.28 L1754.52 1548.85 L1749.63 1548.85 L1761.44 1518.22 L1744.84 1518.22 L1744.84 1514.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1776.18 1542.97 L1781.07 1542.97 L1781.07 1548.85 L1776.18 1548.85 L1776.18 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M1791.3 1514.29 L1809.66 1514.29 L1809.66 1518.22 L1795.58 1518.22 L1795.58 1526.7 Q1796.6 1526.35 1797.62 1526.19 Q1798.64 1526 1799.66 1526 Q1805.44 1526 1808.82 1529.17 Q1812.2 1532.34 1812.2 1537.76 Q1812.2 1543.34 1808.73 1546.44 Q1805.26 1549.52 1798.94 1549.52 Q1796.76 1549.52 1794.49 1549.15 Q1792.25 1548.78 1789.84 1548.04 L1789.84 1543.34 Q1791.92 1544.47 1794.15 1545.03 Q1796.37 1545.58 1798.84 1545.58 Q1802.85 1545.58 1805.19 1543.48 Q1807.53 1541.37 1807.53 1537.76 Q1807.53 1534.15 1805.19 1532.04 Q1802.85 1529.94 1798.84 1529.94 Q1796.97 1529.94 1795.09 1530.35 Q1793.24 1530.77 1791.3 1531.65 L1791.3 1514.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2243.3 1544.91 L2250.94 1544.91 L2250.94 1518.55 L2242.63 1520.21 L2242.63 1515.95 L2250.9 1514.29 L2255.57 1514.29 L2255.57 1544.91 L2263.21 1544.91 L2263.21 1548.85 L2243.3 1548.85 L2243.3 1544.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2282.65 1517.37 Q2279.04 1517.37 2277.21 1520.93 Q2275.41 1524.47 2275.41 1531.6 Q2275.41 1538.71 2277.21 1542.27 Q2279.04 1545.82 2282.65 1545.82 Q2286.29 1545.82 2288.09 1542.27 Q2289.92 1538.71 2289.92 1531.6 Q2289.92 1524.47 2288.09 1520.93 Q2286.29 1517.37 2282.65 1517.37 M2282.65 1513.66 Q2288.46 1513.66 2291.52 1518.27 Q2294.6 1522.85 2294.6 1531.6 Q2294.6 1540.33 2291.52 1544.94 Q2288.46 1549.52 2282.65 1549.52 Q2276.84 1549.52 2273.77 1544.94 Q2270.71 1540.33 2270.71 1531.6 Q2270.71 1522.85 2273.77 1518.27 Q2276.84 1513.66 2282.65 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2302.82 1542.97 L2307.7 1542.97 L2307.7 1548.85 L2302.82 1548.85 L2302.82 1542.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M2327.89 1517.37 Q2324.27 1517.37 2322.45 1520.93 Q2320.64 1524.47 2320.64 1531.6 Q2320.64 1538.71 2322.45 1542.27 Q2324.27 1545.82 2327.89 1545.82 Q2331.52 1545.82 2333.33 1542.27 Q2335.15 1538.71 2335.15 1531.6 Q2335.15 1524.47 2333.33 1520.93 Q2331.52 1517.37 2327.89 1517.37 M2327.89 1513.66 Q2333.7 1513.66 2336.75 1518.27 Q2339.83 1522.85 2339.83 1531.6 Q2339.83 1540.33 2336.75 1544.94 Q2333.7 1549.52 2327.89 1549.52 Q2322.08 1549.52 2319 1544.94 Q2315.94 1540.33 2315.94 1531.6 Q2315.94 1522.85 2319 1518.27 Q2322.08 1513.66 2327.89 1513.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="178.867,1439.9 2352.76,1439.9 "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="178.867,1061.12 2352.76,1061.12 "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="178.867,682.346 2352.76,682.346 "/>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="178.867,303.569 2352.76,303.569 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="178.867,1486.45 178.867,47.2441 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="178.867,1439.9 197.764,1439.9 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="178.867,1061.12 197.764,1061.12 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="178.867,682.346 197.764,682.346 "/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="178.867,303.569 197.764,303.569 "/>
<path clip-path="url(#clip830)" d="M50.9921 1440.35 L80.6679 1440.35 L80.6679 1444.29 L50.9921 1444.29 L50.9921 1440.35 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M103.608 1426.69 L91.8021 1445.14 L103.608 1445.14 L103.608 1426.69 M102.381 1422.62 L108.26 1422.62 L108.26 1445.14 L113.191 1445.14 L113.191 1449.03 L108.26 1449.03 L108.26 1457.18 L103.608 1457.18 L103.608 1449.03 L88.0058 1449.03 L88.0058 1444.52 L102.381 1422.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M130.922 1425.7 Q127.311 1425.7 125.482 1429.26 Q123.677 1432.8 123.677 1439.93 Q123.677 1447.04 125.482 1450.61 Q127.311 1454.15 130.922 1454.15 Q134.556 1454.15 136.362 1450.61 Q138.191 1447.04 138.191 1439.93 Q138.191 1432.8 136.362 1429.26 Q134.556 1425.7 130.922 1425.7 M130.922 1421.99 Q136.732 1421.99 139.788 1426.6 Q142.867 1431.18 142.867 1439.93 Q142.867 1448.66 139.788 1453.27 Q136.732 1457.85 130.922 1457.85 Q125.112 1457.85 122.033 1453.27 Q118.978 1448.66 118.978 1439.93 Q118.978 1431.18 122.033 1426.6 Q125.112 1421.99 130.922 1421.99 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M50.9921 1061.57 L80.6679 1061.57 L80.6679 1065.51 L50.9921 1065.51 L50.9921 1061.57 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M94.7882 1074.47 L111.108 1074.47 L111.108 1078.4 L89.1632 1078.4 L89.1632 1074.47 Q91.8252 1071.71 96.4085 1067.08 Q101.015 1062.43 102.196 1061.09 Q104.441 1058.56 105.321 1056.83 Q106.223 1055.07 106.223 1053.38 Q106.223 1050.62 104.279 1048.89 Q102.358 1047.15 99.2558 1047.15 Q97.0567 1047.15 94.603 1047.92 Q92.1725 1048.68 89.3947 1050.23 L89.3947 1045.51 Q92.2188 1044.38 94.6724 1043.8 Q97.1261 1043.22 99.1632 1043.22 Q104.534 1043.22 107.728 1045.9 Q110.922 1048.59 110.922 1053.08 Q110.922 1055.21 110.112 1057.13 Q109.325 1059.03 107.219 1061.62 Q106.64 1062.29 103.538 1065.51 Q100.436 1068.7 94.7882 1074.47 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M130.922 1046.92 Q127.311 1046.92 125.482 1050.49 Q123.677 1054.03 123.677 1061.16 Q123.677 1068.26 125.482 1071.83 Q127.311 1075.37 130.922 1075.37 Q134.556 1075.37 136.362 1071.83 Q138.191 1068.26 138.191 1061.16 Q138.191 1054.03 136.362 1050.49 Q134.556 1046.92 130.922 1046.92 M130.922 1043.22 Q136.732 1043.22 139.788 1047.82 Q142.867 1052.41 142.867 1061.16 Q142.867 1069.88 139.788 1074.49 Q136.732 1079.07 130.922 1079.07 Q125.112 1079.07 122.033 1074.49 Q118.978 1069.88 118.978 1061.16 Q118.978 1052.41 122.033 1047.82 Q125.112 1043.22 130.922 1043.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M130.922 668.145 Q127.311 668.145 125.482 671.709 Q123.677 675.251 123.677 682.381 Q123.677 689.487 125.482 693.052 Q127.311 696.594 130.922 696.594 Q134.556 696.594 136.362 693.052 Q138.191 689.487 138.191 682.381 Q138.191 675.251 136.362 671.709 Q134.556 668.145 130.922 668.145 M130.922 664.441 Q136.732 664.441 139.788 669.047 Q142.867 673.631 142.867 682.381 Q142.867 691.107 139.788 695.714 Q136.732 700.297 130.922 700.297 Q125.112 700.297 122.033 695.714 Q118.978 691.107 118.978 682.381 Q118.978 673.631 122.033 669.047 Q125.112 664.441 130.922 664.441 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M94.7882 316.914 L111.108 316.914 L111.108 320.849 L89.1632 320.849 L89.1632 316.914 Q91.8252 314.159 96.4085 309.53 Q101.015 304.877 102.196 303.535 Q104.441 301.011 105.321 299.275 Q106.223 297.516 106.223 295.826 Q106.223 293.072 104.279 291.336 Q102.358 289.599 99.2558 289.599 Q97.0567 289.599 94.603 290.363 Q92.1725 291.127 89.3947 292.678 L89.3947 287.956 Q92.2188 286.822 94.6724 286.243 Q97.1261 285.664 99.1632 285.664 Q104.534 285.664 107.728 288.349 Q110.922 291.035 110.922 295.525 Q110.922 297.655 110.112 299.576 Q109.325 301.474 107.219 304.067 Q106.64 304.738 103.538 307.956 Q100.436 311.15 94.7882 316.914 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M130.922 289.368 Q127.311 289.368 125.482 292.933 Q123.677 296.474 123.677 303.604 Q123.677 310.71 125.482 314.275 Q127.311 317.817 130.922 317.817 Q134.556 317.817 136.362 314.275 Q138.191 310.71 138.191 303.604 Q138.191 296.474 136.362 292.933 Q134.556 289.368 130.922 289.368 M130.922 285.664 Q136.732 285.664 139.788 290.271 Q142.867 294.854 142.867 303.604 Q142.867 312.331 139.788 316.937 Q136.732 321.521 130.922 321.521 Q125.112 321.521 122.033 316.937 Q118.978 312.331 118.978 303.604 Q118.978 294.854 122.033 290.271 Q125.112 285.664 130.922 285.664 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip832)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="240.392,682.346 240.559,682.33 241.563,682.237 247.585,681.669 283.718,677.753 390.323,655.999 556.267,568.577 626.229,635.331 681.851,915.488 733.892,900.179 793.648,751.714 862.055,693.608 955.128,659.716 1084.97,593.336 1245.77,440.399 1310.63,630.649 1366.59,1174.95 1430,998.132 1491.88,765.489 1562.08,684.571 1688.97,605.936 1824.86,454.498 1932.12,316.396 1995.5,666.984 2050.54,1445.72 2121.22,1055.82 2187.45,763.675 2257.38,669.797 2291.23,641.387 "/>
<polyline clip-path="url(#clip832)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="240.392,682.346 240.559,682.346 241.563,682.346 247.585,682.335 283.718,682.039 390.323,680.003 556.267,656.24 626.229,560.396 681.851,441.238 733.892,652.569 793.648,792.531 862.055,761.488 955.128,712.068 1084.97,684.832 1245.77,623.989 1310.63,431.912 1366.59,255.698 1430,788.623 1491.88,908.384 1562.08,814.833 1688.97,713.202 1824.86,675.419 1932.12,584.803 1995.5,279.763 2050.54,87.9763 2121.22,943.524 2187.45,999.189 2257.38,853.203 2291.23,800.837 "/>
<path clip-path="url(#clip830)" d="M251.33 250.738 L521.149 250.738 L521.149 95.2176 L251.33 95.2176  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="251.33,250.738 521.149,250.738 521.149,95.2176 251.33,95.2176 251.33,250.738 "/>
<polyline clip-path="url(#clip830)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="275.484,147.058 420.41,147.058 "/>
<path clip-path="url(#clip830)" d="M458.407 166.745 Q456.601 171.375 454.888 172.787 Q453.175 174.199 450.305 174.199 L446.902 174.199 L446.902 170.634 L449.402 170.634 Q451.161 170.634 452.134 169.8 Q453.106 168.967 454.286 165.865 L455.05 163.921 L444.564 138.412 L449.078 138.412 L457.18 158.689 L465.282 138.412 L469.796 138.412 L458.407 166.745 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M477.087 160.402 L484.726 160.402 L484.726 134.037 L476.416 135.703 L476.416 131.444 L484.68 129.778 L489.356 129.778 L489.356 160.402 L496.994 160.402 L496.994 164.338 L477.087 164.338 L477.087 160.402 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><polyline clip-path="url(#clip830)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:12; stroke-opacity:1; fill:none" points="275.484,198.898 420.41,198.898 "/>
<path clip-path="url(#clip830)" d="M458.407 218.585 Q456.601 223.215 454.888 224.627 Q453.175 226.039 450.305 226.039 L446.902 226.039 L446.902 222.474 L449.402 222.474 Q451.161 222.474 452.134 221.64 Q453.106 220.807 454.286 217.705 L455.05 215.761 L444.564 190.252 L449.078 190.252 L457.18 210.529 L465.282 190.252 L469.796 190.252 L458.407 218.585 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /><path clip-path="url(#clip830)" d="M480.305 212.242 L496.624 212.242 L496.624 216.178 L474.68 216.178 L474.68 212.242 Q477.342 209.488 481.925 204.858 Q486.532 200.205 487.712 198.863 Q489.957 196.34 490.837 194.604 Q491.74 192.844 491.74 191.155 Q491.74 188.4 489.795 186.664 Q487.874 184.928 484.772 184.928 Q482.573 184.928 480.12 185.692 Q477.689 186.455 474.911 188.006 L474.911 183.284 Q477.735 182.15 480.189 181.571 Q482.643 180.993 484.68 180.993 Q490.05 180.993 493.245 183.678 Q496.439 186.363 496.439 190.854 Q496.439 192.983 495.629 194.905 Q494.842 196.803 492.735 199.395 Q492.157 200.067 489.055 203.284 Q485.953 206.479 480.305 212.242 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1" /></svg>
<p>transposing so that the rows (the timeseries) is plotted.</p><p><img src="https://user-images.githubusercontent.com/1814174/170916167-11d1b5c6-3c3c-439a-92af-d3899e24d2ad.png" alt="Local Sensitivity Solution"/></p><p>For more information on the internal representation of the <code>ODEForwardSensitivityProblem</code> solution, see the <a href="../../manual/direct_forward_sensitivity/#forward_sense">direct forward sensitivity analysis manual page</a>.</p><h2 id="Example-using-adjoint_sensitivities-for-discrete-adjoints"><a class="docs-heading-anchor" href="#Example-using-adjoint_sensitivities-for-discrete-adjoints">Example using <code>adjoint_sensitivities</code> for discrete adjoints</a><a id="Example-using-adjoint_sensitivities-for-discrete-adjoints-1"></a><a class="docs-heading-anchor-permalink" href="#Example-using-adjoint_sensitivities-for-discrete-adjoints" title="Permalink"></a></h2><p>In this example, we will show solving for the adjoint sensitivities of a discrete cost functional. First, let&#39;s solve the ODE and get a high quality continuous solution:</p><pre><code class="language-julia hljs">function f(du, u, p, t)
    du[1] = dx = p[1] * u[1] - p[2] * u[1] * u[2]
    du[2] = dy = -p[3] * u[2] + u[1] * u[2]
end

p = [1.5, 1.0, 3.0]
prob = ODEProblem(f, [1.0; 1.0], (0.0, 10.0), p)
sol = solve(prob, Vern9(), abstol = 1e-10, reltol = 1e-10)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
Interpolation: specialized 9th order lazy interpolation
t: 90-element Vector{Float64}:
  0.0
  0.04354162443296621
  0.12389885142933849
  0.22523821249177148
  0.33845438859165394
  0.46907775228263315
  0.617679984025429
  0.7795139393491435
  0.9428345448451071
  1.1037317064732923
  ⋮
  9.244741175998675
  9.33507697985715
  9.415258313589296
  9.505108602367457
  9.59753819404745
  9.701302740496649
  9.82107074257618
  9.944264698911127
 10.0
u: 90-element Vector{Vector{Float64}}:
 [1.0, 1.0]
 [1.0238868996864754, 0.9170635457394599]
 [1.078916507168589, 0.7840700680684657]
 [1.1684379623416628, 0.648176105427661]
 [1.2957301699774149, 0.5304507724469475]
 [1.4809255480771804, 0.4295497813092081]
 [1.7473385307311255, 0.34932833810849667]
 [2.1153411662091637, 0.2935022632596655]
 [2.583231428922633, 0.2635343065672018]
 [3.1543469690428196, 0.2576255917381491]
 ⋮
 [1.6314198304883223, 3.8647953634519823]
 [1.3472257806180403, 3.3687127842090487]
 [1.180505952630769, 2.9296455951307765]
 [1.0600872157971106, 2.473290528404606]
 [0.988041849424572, 2.0597293996335635]
 [0.9520586556614907, 1.6679344737296462]
 [0.95446743302, 1.3047869112296333]
 [0.9960208012656512, 1.0163616515534164]
 [1.0263447674847044, 0.9096910781836091]</code></pre><p>Now let&#39;s calculate the sensitivity of the <span>$\ell_2$</span> error against 1 at evenly spaced points in time, that is:</p><p class="math-container">\[L(u,p,t)=\sum_{i=1}^{n}\frac{\Vert1-u(t_{i},p)\Vert^{2}}{2}\]</p><p>for <span>$t_i = 0.5i$</span>. This is the assumption that the data is <code>data[i]=1.0</code>. For this function, notice we have that:</p><p class="math-container">\[\begin{aligned}
dg_{1}&amp;=1-u_{1} \\
dg_{2}&amp;=1-u_{2} \\
&amp; \quad \vdots
\end{aligned}\]</p><p>and thus:</p><pre><code class="language-julia hljs">dg(out, u, p, t, i) = (out .= 1.0 .- u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">dg (generic function with 1 method)</code></pre><p>Also, we can omit <code>dgdp</code>, because the cost function doesn&#39;t dependent on <code>p</code>. If we had data, we&#39;d just replace <code>1.0</code> with <code>data[i]</code>. To get the adjoint sensitivities, call:</p><pre><code class="language-julia hljs">ts = 0:0.5:10
res = adjoint_sensitivities(sol, Vern9(), t = ts, dgdu_discrete = dg, abstol = 1e-14,
    reltol = 1e-14)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([87.9487776019265, 22.488417336810453], [-25.500654352896134 77.25507872033329 -93.53213951023224])</code></pre><p>This is super high accuracy. As always, there&#39;s a tradeoff between accuracy and computation time. We can check this almost exactly matches the autodifferentiation and numerical differentiation results:</p><pre><code class="language-julia hljs">using ForwardDiff, Calculus, ReverseDiff, Tracker
function G(p)
    tmp_prob = remake(prob, u0 = convert.(eltype(p), prob.u0), p = p)
    sol = solve(tmp_prob, Vern9(), abstol = 1e-14, reltol = 1e-14, saveat = ts,
        sensealg = SensitivityADPassThrough())
    A = convert(Array, sol)
    sum(((1 .- A) .^ 2) ./ 2)
end
res2 = ForwardDiff.gradient(G, [1.5, 1.0, 3.0])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Float64}:
  25.50063723178539
 -77.25507741525327
  93.53212756432467</code></pre><p>and see this gives the same values.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../parameter_estimation_ode/">« Parameter Estimation of Ordinary Differential Equations</a><a class="docs-footer-nextpage" href="../adjoint_continuous_functional/">Adjoint Sensitivity Analysis of Continuous Functionals »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 1 August 2023 09:43">Tuesday 1 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
